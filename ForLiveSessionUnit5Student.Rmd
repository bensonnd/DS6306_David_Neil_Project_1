---
title: "DS6306 Unit 2 FLS"
author: "Neil D. Benson"
date: "5/9/2020"
output: word_document
always_allow_html: true
---

## Set up the notebook and clean up some of the data
```{r}
library(stringr)
library(dplyr)
library(ggExtra)
library(ggplot2)
library(plotly)
library(stringr)
library(ggthemes)
library(ggExtra)
library(tidyr)

bballdata<-read.csv("/Git/MSDS_6306_Doing-Data-Science/Unit 2/PlayersBBall.csv", header=TRUE)

data_subset <- bballdata[ , c("position","height","weight","birth_date")]     # columns to remove missing values

bball <- bballdata[complete.cases(data_subset), ]                             # Omit NAs by columns in data_subset - this doesn't seem to be working

# function to convert height string to numerical
convert_str_ht <- function(height){
    height = str_match(height, "(\\d)(-|')(\\d+)")
    ft <- as.integer(height[1,2]) * 12  # get the feet, convert to numeric inches
    inches <- as.integer(height[1,4])   # convert to numeric
    return(as.integer(ft + inches))
}

convert_str_wt <- function(weight){
    weight = str_match(weight, "^\\d+")
    return(as.integer(weight))
}

convert_wagevalue <- function(wageorvalue){
    reg = "(\\d+)\\.(\\d+)([MK])|(\\d+)([MK])"
    
    wageorvalue = str_match(wageorvalue, regex(reg,ignore_case = TRUE))
    
    if (!is.na(wageorvalue[1,2]) & !is.na(wageorvalue[1,3])) {

       if(tolower(wageorvalue[1,4]) == 'm') {
        money = (as.integer(wageorvalue[1,2])) + (as.integer(wageorvalue[1,3])/10)
       }

       if(tolower(wageorvalue[1,4]) == 'k') {
        money = ((as.integer(wageorvalue[1,2])) + (as.integer(wageorvalue[1,3])/10))/1000
       }
    } 
    
    else  {
      if(!is.na(wageorvalue[1,5]) & !is.na(wageorvalue[1,6])) {

        if(tolower(wageorvalue[1,6]) == 'm') {
          money = (as.integer(wageorvalue[1,5]))
        }
      
        if(tolower(wageorvalue[1,6]) == 'k') {
          money = as.integer(wageorvalue[1,5])/1000
        }
      
      }
    }
    
    return(as.numeric(money))
}


# convert the height col to numeric int
bball["TotalInches"] <- apply(bball["height"], 1, convert_str_ht) 
bball <- bball %>% select(-height)
```


## Visualize the distribution of the height of any of the positions
```{r}
# plot  
bball %>% ggplot(aes(x = TotalInches, fill = position)) + 
  geom_histogram() + 
  facet_wrap(~ position) +
  ggtitle("Height distributions by Position") +
  theme_economist() +
  theme(legend.position="right")
```


## Load Fifa data and convert weight and height to numeric
```{r}
fifa = read.csv("/Git/MSDS_6306_Doing-Data-Science/Unit 3/FIFA Players.csv", header = TRUE)

# convert the Height column to numeric inches
fifa["Height"] <- apply(fifa["Height"], 1, convert_str_ht) 

# convert the Height column to numeric lbs
fifa["Weight"] <- apply(fifa["Weight"], 1, convert_str_wt)
```


## Visualize the relationship between soccer players' Height and Weight
```{r}
theme_set(theme_economist())
g <- ggplot(fifa[!is.na(Position)], aes(Weight, Height)) + 
  geom_count() + 
  geom_smooth(method="lm", se=F) +
  ggtitle("Soccer Players - Height Weight Relationship") +
  xlab("Weight (lbs)") +
  ylab("Height (in)")

ggMarginal(g, type = "histogram", fill="transparent")
```


## Visualize the relationship between soccer players' Height and Weight for positions LM and LB
```{r}
fifalmlb <- fifa %>%
filter(Position == "LB" | Position == "LM")

theme_set(theme_economist())
g <- ggplot(fifalmlb[!is.na(Position)], aes(Weight, Height)) + 
  geom_count() + 
  geom_smooth(method="lm", se=F) +
  ggtitle("Soccer Players - Height Weight Relationship") +
  xlab("Weight (lbs)") +
  ylab("Height (in)")

ggMarginal(g, type = "histogram", fill="transparent")
```


## There is reasonably strong evidence that the player’s weight is related to the player’s height
```{r}

df2015 = read.csv("/Git/MSDS_6306_Doing-Data-Science/Unit 5/yob2015.txt", header = FALSE)
df2016 = read.csv("/Git/MSDS_6306_Doing-Data-Science/Unit 5/yob2016.txt", header = FALSE, sep = ";")

# give the dataframes column names
col_names = c("Name", "Sex", "Count")
colnames(df2015) <- col_names
colnames(df2016) <- col_names


# they all start with z, they're all male, and all have a count of 5  
tail(df2015, 10)


# give the summary and structure of the dataframes
# 2015
print(paste0("df2015 has ", dim(df2015)[1], " rows and ", dim(df2015)[2], " columns."))
str(df2015)
summary(df2015)

# #2016
print(paste0("df2016 has ", dim(df2016)[1], " rows and ", dim(df2016)[2], " columns."))
str(df2016)
summary(df2016)

# filter out any names with any triple repeating characters ex ('britanyyy')
reg = "([a-z])\\1{2}"
y2015 <- df2015 %>%
  filter(!str_detect(Name, reg)) 

y2016 <- df2016 %>%
  filter(!str_detect(Name, reg)) 

# give the summary and structure of the dataframes after filtering for triple chars
# 2015
print(paste0("y2015 has ", dim(y2015)[1], " rows and ", dim(y2015)[2], " columns."))
str(y2015)
summary(y2015)

# #2016
print(paste0("y2016 has ", dim(y2016)[1], " rows and ", dim(y2016)[2], " columns."))
str(y2016)
summary(y2016)

# inner join the dataframes together
final <- inner_join(y2015, y2016, by = c("Name" = "Name", "Sex" = "Sex") , copy = FALSE, suffix = c("_2015", "_2016"))

# add both years together for Total
final$Total <- final$Count_2015 + final$Count_2016


# sort by total count of names between both years
final <- final[order(-final$Total),] 


# top 10 most popular names in 2015 and 2016 conbined
head(final$Name, 10)

# 2015 and 2016 poular girl names
finalgirls <- final %>% filter(Sex == 'F')
finalgirls <- finalgirls[order(-finalgirls$Total),] 


finalgirlstop10 <- top_n(finalgirls, n = 10, wt=Total) %>% select(Name)

top10girlspath = "/Git/MSDS_6306_Doing-Data-Science/Unit 5/top10girls.csv"
write.csv(finalgirlstop10, top10girlspath)

# gather the year columns and set to integer
finalgirlstop10 <- gather(top_n(finalgirls, n = 10, wt=Total), Year, Total, 3:4)
yearreg = "\\d+$"
finalgirlstop10["Year"] <- lapply(finalgirlstop10["Year"], function(x) as.factor(str_extract(x, yearreg)))


theme_set(theme_economist())
finalgirlstop10 %>% ggplot(aes(x = reorder(Name, -Total), y=Total, fill=Year)) +
  geom_bar(stat="identity") +
  ggtitle("Most Popular Girl Names - 2015 & 2016") +
  xlab("Names") +
  ylab("Total") +
  theme(legend.position="bottom") + 
  theme(text = element_text(size=12),
        axis.text.x = element_text(angle=30, hjust=.5, margin = margin(t = -10, b = 20)),
        axis.text.y = element_text(margin = margin(l = 15, r = 10)),
        axis.title.x = element_text(size = 14, face = "bold"),
        axis.title.y = element_text(size = 14, face = "bold"))
```

